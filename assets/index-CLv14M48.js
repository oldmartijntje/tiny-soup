var f=Object.defineProperty;var m=(r,t,e)=>t in r?f(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var i=(r,t,e)=>m(r,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&n(h)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();class w{constructor(t,e){i(this,"lastFrameTime");i(this,"accumulatedTime");i(this,"timeStep");i(this,"update");i(this,"render");i(this,"isRunning");i(this,"rafId");i(this,"mainLoop",t=>{if(!this.isRunning)return;let e=t-this.lastFrameTime;for(this.lastFrameTime=t,this.accumulatedTime+=e;this.accumulatedTime>=this.timeStep;)this.update(this.timeStep),this.accumulatedTime-=this.timeStep;this.render(),this.rafId=requestAnimationFrame(this.mainLoop)});this.lastFrameTime=0,this.accumulatedTime=0,this.timeStep=1e3/60,this.update=t,this.render=e,this.rafId=null,this.isRunning=!1}start(){this.isRunning||(this.isRunning=!0,this.rafId=requestAnimationFrame(this.mainLoop))}stop(){this.rafId!==null&&(cancelAnimationFrame(this.rafId),this.rafId=null),this.isRunning=!1}}var p=(r=>(r[r.Floor=0]="Floor",r[r.HUD=1]="HUD",r))(p||{}),c=(r=>(r[r.UP=0]="UP",r[r.DOWN=1]="DOWN",r[r.LEFT=2]="LEFT",r[r.RIGHT=3]="RIGHT",r))(c||{});const l={gridSize:32};class g{constructor(t=0,e=0){i(this,"_x");i(this,"_y");this._x=t,this._y=e}get x(){return this._x}set x(t){this._x=t}get y(){return this._y}set y(t){this._y=t}duplicate(){return new g(this.x,this.y)}matches(t){return this.x===t.x&&this.y===t.y}toString(){return`Vector2(${this.x}, ${this.y})`}toNeighbor(t){let e=this.x,n=this.y;switch(t){case c.UP:n-=l.gridSize;break;case c.DOWN:n+=l.gridSize;break;case c.LEFT:e-=l.gridSize;break;case c.RIGHT:e+=l.gridSize;break}if(e==this.x&&n==this.y)throw new Error("Invalid direction "+t+" for "+this.toString());return new g(e,n)}}class y{constructor(t,e){i(this,"logger");i(this,"stringified");this.logger=t,this.stringified=e}LogError(){return this.logger.LogError(this.stringified),this}LogWarning(){return this.logger.LogWarning(this.stringified),this}LogInfo(){return this.logger.LogInfo(this.stringified),this}PrependText(t){return this.stringified=t+this.stringified,this}AppendText(t){return this.stringified=t+this.stringified,this}}class L{constructor(t){i(this,"context");this.context=t==null?void 0:t.constructor.name}OverrideName(t){return this.context=t.GetName(),this}StringifyObject(t){return new y(this,JSON.stringify(t))}FormatMessage(t){return`[${new Date().toISOString()}] [${this.context}] ${t}`}LogMessage(t,e){const n=this.FormatMessage(t);switch(e){case 0:console.log(`[INFO] ${n}`);break;case 1:console.warn(`[WARNING] ${n}`);break;case 2:console.error(`[ERROR] ${n}`);break}}LogInfo(t){this.LogMessage(t,0)}LogWarning(t){this.LogMessage(t,1)}LogError(t){this.LogMessage(t,2)}}class I{constructor(t){i(this,"position");i(this,"children");i(this,"parent");i(this,"hasBeenInitiated");i(this,"drawLayer");i(this,"_logger");this.position=(t==null?void 0:t.position)??new g(0,0),this.children=(t==null?void 0:t.children)??[],this.hasBeenInitiated=!1,this.drawLayer=(t==null?void 0:t.drawLayer)??null,this.parent=(t==null?void 0:t.parent)??null,this._logger=new L(this),queueMicrotask(()=>{this.onInit(),this.hasBeenInitiated=!0})}stepEntry(t,e){this.children.forEach(n=>n.stepEntry(t,e)),this.hasBeenInitiated||(this.hasBeenInitiated=!0,this.onInit()),this.step(t,e)}onInit(){this._logger.LogInfo("Running onInit()")}step(t,e){}draw(t,e,n){const s=e+this.position.x,o=n+this.position.y;this.drawImage(t,s,o),this.getDrawChildrenOrdered().forEach(h=>h.draw(t,s,o))}getDrawChildrenOrdered(){return[...this.children].sort((t,e)=>e.drawLayer===p.Floor||t.position.y>e.position.y?1:-1)}drawImage(t,e,n){}destroy(){this.children.forEach(t=>t.destroy()),this.parent&&this.parent.removeChild(this)}addChild(t){t.parent=this,this.children.push(t)}removeChild(t){this.children=this.children.filter(e=>e!==t)}}class x extends I{constructor(t){super(t),this.position=new g(0,0)}drawBackground(t){}drawObjects(t){this.children.forEach(e=>{e.drawLayer!==p.HUD&&e.draw(t,0,0)})}drawForeground(t){this.children.forEach(e=>{e.drawLayer===p.HUD&&e.draw(t,0,0)})}}const u=document.querySelector("#game-canvas");if(u==null)throw Error("canvas is null");if(!(u instanceof HTMLCanvasElement))throw Error("canvas is not canvastype");const a=u.getContext("2d");if(a==null)throw Error("ctx is null");console.log("code works!");const d=new x,O=r=>{d.stepEntry(r,d)},F=()=>{a.clearRect(0,0,u.width,u.height),d.drawBackground(a),a.save(),d.drawObjects(a),a.restore(),d.drawForeground(a)},T=new w(O,F);T.start();
